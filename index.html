<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> The Lucky Racer </title>
    <link rel="stylesheet" href="style.css?v=43">
</head>
<body>
    <!-- Remove tab navigation, keep single page -->
    <div class="container">
            <h1> The Lucky Racer - Settings </h1>
            
            <!-- Loading Indicator -->
            <div class="loading-container" id="loadingContainer">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loadingText">Loading icons...</div>
                <div class="loading-progress" id="loadingProgress">0%</div>
            </div>
            
            <!-- Game Settings -->
            <div class="settings-panel" id="settingsPanel">
            <h2>Race Settings</h2>
            <div class="input-group">
                <label for="duckCount">Number of Racers:</label>
                <input type="number" id="duckCount" min="10" max="2000" value="300">
            </div>
            <div class="input-group">
                <label for="raceDuration">Race Duration (seconds):</label>
                <input type="number" id="raceDuration" min="5" max="300" value="30">
            </div>
            <div class="input-group">
                <label for="duckNamesFile">Racer List File (CSV/Excel):</label>
                <input type="file" id="duckNamesFile" accept=".csv,.xlsx" onchange="game.loadDuckNames(event)">
                <small style="color: #888;">Upload CSV file with columns: No. and Name</small>
            </div>
            <div class="input-group">
                <label for="iconTheme">Icon Theme:</label>
                <select id="iconTheme" onchange="game.changeIconTheme()">
                    <option value="output_1">Theme 1</option>
                    <option value="output_2">Theme 2</option>
                </select>
                <small style="color: #888;" id="iconCount">0 icon</small>
            </div>
            <div class="input-group">
                <label for="soundToggle">
                    <input type="checkbox" id="soundToggle" checked> Enable Sound
                </label>
            </div>
            <div class="input-group">
                <button class="btn btn-secondary" id="openDisplayBtn" onclick="game.openDisplayWindow()" style="width: 100%; margin-bottom: 10px;" disabled>
                    â³ Loading Icons...
                </button>
                <small style="color: #888;">Open this on projector/TV for audience view</small>
            </div>
            <button class="btn btn-primary" id="startRaceBtn" onclick="game.startRace()" disabled>Loading...</button>
        </div>

        <!-- Leaderboard -->
        <div class="history-win" id="historyWin">
            <h3>ğŸ† Victory History</h3>
            <div id="historyWinList"></div>
            <button class="btn btn-small" onclick="game.resetHistory()" style="margin-top: 10px; width: 100%;">ğŸ”„ Restart (Clear History)</button>
        </div>

        <!-- Results -->
        <div class="result-panel hidden" id="resultPanel">
            <h2 id="resultTitle">Results</h2>
            <div id="resultMessage"></div>
        </div>

        <!-- Race History -->
        <div class="history-panel hidden" id="historyPanel">
            <h2>ğŸ“Š Race History</h2>
            <div id="historyList"></div>
            <button class="btn btn-primary" onclick="game.closeHistory()">Close</button>
        </div>
        
        <!-- Race Info (for control window) -->
        <div class="race-info hidden" id="raceInfo" style="margin-top: 20px; position: relative;">
            <div class="info-item">
                <span class="label">Race:</span>
                <span id="raceNumber" class="value">#1</span>
            </div>
            <div class="info-item">
                <span class="label">Time Left:</span>
                <span id="timeLeft" class="value">30s</span>
            </div>
            <div class="info-item">
                <span class="label">Status:</span>
                <span id="raceStatus" class="value">Waiting</span>
            </div>
        </div>

        <!-- Control Panel (for control window) -->
        <div class="control-panel hidden" id="controlPanel" style="margin-top: 20px; position: relative; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button class="btn btn-small" onclick="game.goHome()" id="homeBtn">ğŸ  Home</button>
            <button class="btn btn-small" onclick="game.startRace()" id="controlStartBtn" disabled>Loading...</button>
            <button class="btn btn-small" onclick="game.pauseRace()" id="pauseBtn">â¸ Pause</button>
            <button class="btn btn-small" onclick="game.resumeRace()" id="resumeBtn" disabled>â–¶ Resume</button>
            <button class="btn btn-primary" onclick="game.continueRace()" id="continueBtn" style="display: none;">ğŸ¯ Next Race</button>
            <button class="btn btn-secondary" onclick="game.showWinnersPanel()" id="viewResultsBtn">ğŸ“‹ View Results</button>
        </div>

        <!-- Race Track HIDDEN on control screen - only visible on display.html -->
        <div class="race-track hidden" id="raceTrack" style="display: none !important;">
            <div class="big-timer hidden" id="bigTimer">
                <div class="timer-display">00:00:00</div>
            </div>
            <div class="bank-top" id="bankTop"></div>
            <div class="race-river" id="raceRiver">
                <div class="water-flow"></div>
                <div class="water-ripples"></div>
                <div class="fish-layer" id="fishLayer">
                    <div class="fish fish-1">ğŸŸ</div>
                    <div class="fish fish-2">ğŸ </div>
                    <div class="fish fish-3">ğŸ¡</div>
                    <div class="fish fish-4">ğŸŸ</div>
                    <div class="fish fish-5">ğŸ </div>
                </div>
                <!-- Ducks will be added here dynamically -->
            </div>
            <div class="bank-bot" id="bankBot">
                <button class="btn btn-primary hidden" onclick="game.continueRace()" id="continueBankBtn" style="position: absolute; left: 50%; transform: translateX(-50%); bottom: 20px; z-index: 1000;">ğŸ¯ Continue Next Race</button>
            </div>
            <div class="finish-line hidden" id="finishLine">FINISH</div>
        </div>
    </div>
    </div>

    <!-- Victory Popup (outside container for max z-index) -->
    <div class="victory-popup hidden" id="victoryPopup">
        <div class="victory-overlay" onclick="game.closeVictoryPopup()"></div>
        <div class="victory-content">
            <div class="victory-header">
                <h1>ğŸ‰ VICTORY! ğŸ‰</h1>
            </div>
            <div class="victory-body">
                <div class="winner-icon" id="winnerIcon"></div>
                <h2 class="winner-name" id="winnerName">Winner Name</h2>
                <div class="winner-stats" id="winnerStats"></div>
            </div>
            <div class="victory-footer">
                <button class="btn btn-primary" onclick="game.continueRace()">ğŸ¯ Continue (Next Race)</button>
                <button class="btn btn-secondary" onclick="game.closeVictoryPopup(); game.showWinnersPanel()">ğŸ“‹ View Results</button>
            </div>
        </div>
    </div>

    <!-- SheetJS library for Excel file support -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <script src="game.js?v=22"></script>
    <script>
        // Debug: Check if game object exists
        window.addEventListener('load', function() {
            console.log('Page loaded');
            console.log('Game object exists:', typeof game !== 'undefined');
            if (typeof game !== 'undefined') {
                console.log('Game initialized successfully');
            } else {
                console.error('Game object not found! Check game.js for errors.');
            }
        });
    </script>
</body>
</html>
